<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>城市权限主页</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<!-- Ionicons -->
		<link rel="stylesheet" href="../css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="../css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="../css/_all-skins.min.css">
		<link rel="stylesheet" href="../css/img_preview.css">
		<link rel="stylesheet" href="../css/newmui.min.css">
		<script type="text/javascript" src="../js/common.js"></script>
		<style>
			html,
			body {
				height: 100%;
				background-size: cover;
				min-height: 100%;
			}
			
			.select {
				height: 3rem;
				width: 50%;
				margin-left: 20px;
				background: #000;
			}
			
			.navbar-nav>.user-menu>.dropdown-menu>li.user-header>p {
				line-height: 22px;
			}
			
			header {
				position: fixed!important;
				width: 100%;
			}
			
			.mui-scroll-wrapper {
				padding-top: 15px;
			}
			
			ul {
				margin-top: 70px;
				margin-bottom: 60px;
				font-size: 16px;
			}
			/*ul a {
				display: block;
				overflow: hidden;
				margin: 0 0 20px 10px;
				border-bottom: 1px solid rgba(0, 0, 0, 0.1);
				padding-bottom: 10px;
			}*/
			
			ul a:nth-last-child(1) {
				border: none;
			}
			
			ul .col-xs-2 div {
				width: 48px;
				height: 48px;
				line-height: 48px;
				border-radius: 8px;
				font-size: 30px;
				text-align: center;
				color: #fff;
				margin: 0 auto;
			}
			
			ul .col-xs-10 {
				position: relative;
			}
			
			ul h5 {
				color: #333;
				margin: 6px 0;
				font-size: 16px;
			}
			
			ul h5 span {
				font-size: 14px;
			}
			
			.baifang {
				background-color: #d8505c;
			}
			
			.yonghu {
				background-color: #ffb220;
			}
			
			.mima {
				background-color: #76bd3d;
			}
			
			.kaoqin {
				background-color: #538ef1;
			}
			
			.gonggao {
				background-color: #ff7100;
			}
			
			footer {
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100%;
				border-top: 1px solid #c3c3c3;
				background-color: #fff;
				text-align: center;
				color: #666;
				height: 50px;
				padding-top: 2px;
				z-index: 100;
			}
			
			footer p {
				font-size: 20px;
				margin: 0 0 -3px 0;
			}
			
			footer a,
			footer a:hover,
			footer a:active,
			footer a:visited {
				color: #666;
			}
			
			.mark-green {
				color: #169a80!important;
			}
			
			.barcode_scan {
				background: url(../images/icon38.png) no-repeat center center;
				display: inline-block;
				width: 20px;
				height: 20px;
				background-size: 100%;
				position: absolute;
				right: 20px;
				top: 30px;
			}
			html,body{background: #fff;}
    .navbar-nav > .user-menu > .dropdown-menu > li.user-header > p{line-height: 22px;}
    header{position: fixed!important; width: 100%;}
    .mui-scroll-wrapper{padding-top: 15px;}
    .main{padding-top: 70px; padding-bottom: 60px; font-size: 16px;}
    section h5{padding: 5% 15%;}
    section h5 img{width: 100%;}
    .city_type{margin: 15px 30px; background-color: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.3); border-radius: 10px; position: relative;}
    .city_type .col-xs-6{ padding: 30px 40px; text-align: center;}
    .city_type .col-xs-6 img{height: 65px;}
    .city_type .col-xs-6 p{padding-top: 10px;}
    .line{width: 90%; height: 1px; overflow: hidden;background: -webkit-linear-gradient(left, rgba(182,219,238,0.5) , rgba(182,219,238,1) , rgba(182,219,238,0.5));  background: -o-linear-gradient(right, rgba(182,219,238,0.5) , rgba(182,219,238,1) , rgba(182,219,238,0.5));  background: -moz-linear-gradient(right, rgba(182,219,238,0.5) , rgba(182,219,238,1) , rgba(182,219,238,0.5));  background: linear-gradient(to right, rgba(182,219,238,0.5) , rgba(182,219,238,1) , rgba(182,219,238,0.5)); position: absolute;}
    .line1{top: 50%; left: 5%; margin-top: -1px;}
    .line2{transform: rotate(90deg); -webkit-transform: rotate(90deg); -o-transform: rotate(90deg); -moz-transform: rotate(90deg); bottom: 50%; left: 5%;}
		</style>
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<!-- Site wrapper -->
		<!--主页部分-->
		<div class=" mui-off-canvas-wrap mui-slide-in" id="offCanvasWrapper">

			<div class="mui-inner-wrap wrapper">
				<header class="main-header">
					<!-- Logo -->
					<nav class="navbar navbar-static-top text-center">
						<a href="#offCanvasSide" class="sidebar-toggle fa fa-navicon mui-icon-bars"></a>
						<span>城市动态</span>
						<a href="#" class="barcode_scan" onclick="clicked('scan_login.html',true,true);"></a>
					</nav>

				</header>
				<div class="mui-content mui-scroll-wrapper">
				    <!-- Content Wrapper. Contains page content -->
				      <section class="main">
				        <h5><img src="../images/app_img1.png"/> </h5>
				        <div class="clearfix city_type">
				          <div class="col-xs-6" onclick="toTurnover()"><img src="../images/app_img2.png"><p>营业额</p></div>
				          <div class="col-xs-6" onclick="toCustomer()"><img src="../images/app_img3.png"><p>客户</p></div>
				          <div class="col-xs-6" onclick="toNetwork()"><img src="../images/app_img4.png"><p>线下网络</p></div>
				          <div class="col-xs-6" onclick="toOther()"><img src="../images/app_img5.png"><p>其他</p></div>
				          <div class="line line1"></div>
				          <div class="line line2"></div>
				        </div>
				      </section>
				    </div>
				<div class="mui-off-canvas-backdrop" id="backdrop"></div>
				<footer>
					<a class="col-xs-4 mark-green" id="maps" href="javascript:void(0)">
						<p><i class="fa fa-bar-chart-o"></i></p>动态</a>
					<a class="col-xs-4" id="web_message" path="web_message.html" onclick="jump(this)">
						<p><i class="fa fa-envelope-o"></i></p>消息
						<div id="message_state_div"></div>
					</a>
					<a class="col-xs-4" id="cs_my" path="cs_my.html" onclick="jump(this)">
						<p><i class="fa fa-user"></i></p>我</a>

		</footer>
			</div>
			<!--侧滑部分-->
			<aside id="offCanvasSide" class="main-sidebar mui-off-canvas-left">
				<section id="offCanvasSideScroll" class="sidebar">
					<!-- Sidebar user panel -->
					<div class="user-panel">
						<div class="text-center image">
							<img src="" class="img-circle" data-preview-src="" data-preview-group="1">
							<p style="margin-top: 10px;"><strong id="user_name"></strong></p>
							<p><span id="user_zw"></span><span id="user_employeeid"></span></p>
							<!--<span id="div_title" style="display: block;margin-top:10px;"></span>
							<select class="select" id="select">
							</select>
							<p id="store_num" style="display: block;margin-top:10px;"><span>门店编号：</span><span id="storeid"></span></p>-->
						</div>
					</div>
					<!-- sidebar menu: : style can be found in sidebar.less -->
					<ul class="sidebar-menu" style="font-size: 14px;">
						<div style="padding:0px 0px 0px 18px;">
							<a>
								<span>所属门店：</span>
								<span id="div_title"></span>
								<select class="select" id="select" style="margin-left: 0px;">
								</select>
							</a>
						</div>
						<div id="store_num" style="padding:18px 0px 0px 18px;">
							<a><span>门店编号：</span><span id="storeid" style="margin-left: 4px;"></span>
							</a>
						</div>
						<li class="treeview" style="display: none; padding-top: 10px;" id="store_datacard">
							<a onclick="toStoreDataCard()">
								<span>门店数据卡</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview" style="display: none;" id="shopkeeper_information">
							<a onclick="toInfromation()">
								<span>个人信息</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview" style="display: none;" id="shopuser_information">
							<a onclick="toGuoAnXiaList()">
								<span>门店人员</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview" style="display: none; padding-top: 10px;" id="datacard">
							<a onclick="toCard()">
								<span>国安侠数据卡</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview" style="display: none;" id="my_area">
							<a onclick="toUser()">
								<span>我的片区</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview">
							<a onclick="toUpdatePassword()">
								<span>修改密码</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>

						<li class="text-center" style="margin-top: 2rem;">
							<a id="btnLogout">退出登录</a>
						</li>

					</ul>

				</section>
			</aside>

		</div>
		<script src="../js/jQuery-2.2.0.min.js"></script>
		<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
		<script type="text/javascript" src="../js/custom_common.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/previewimage.js"></script>
		<script src="../js/mui.zoom.js"></script>
		<script>
			var employee = JSON.parse(localStorage.getItem('employee'));
			var selectArea_list = JSON.parse(localStorage.getItem('selectArea_list'));
			var store_list = JSON.parse(localStorage.getItem('storelist'));
			var employee_pic = JSON.parse(localStorage.getItem('employee_pic'));
			var store = null;
			var storelist = null;
			var v = employee.employeeId;
			var w = null;
			var store_no = null;
			var zw = employee.usergroup.code;
			var lat = null;
			var lon = null;
			mui.previewImage();

			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				if(employee.usergroup != null) {
					if(employee.usergroup.code == 'GAX') {
						$("#datacard").css("display", "");
						$("#my_area").css("display", "");
					} else if(employee.usergroup.code == 'DZ') {
						$("#store_datacard").css("display", "");
						$("#shopkeeper_information").css("display", "");
						$("#shopuser_information").css("display", "");
					}
				}

				initView();
				initStore();
				//退出
				var t_username = localStorage.getItem("employee_key");
				mui('#btnLogout')[0].addEventListener('click', function(event) {
					setTimeout(function() {
						var webview = plus.webview.getWebviewById('login');
						if(webview != null) {
							webview.close();
						}
						localStorage.clear();
						localStorage.setItem("employee_key", t_username);
						mui.openWindow({
							url: '../login.html',
							id: 'login',
							createNew: true,
							show: {
								aniShow: "slide-in-right"
							},
							waiting: {
								autoShow: false
							}
						});
					}, 50);
				});

			}

			function initView() {
				if(employee != null) {
					if(employee.name == null || employee.name == "") {
						$("#user_name").html("无数据");
					} else {
						$("#user_name").html(employee.name);
					}
					if(employee.zw == null || employee.zw == "") {
						$("#user_zw").text("无数据");
					} else {
						$("#user_zw").text(employee.zw);
					}

					if(employee.employeeId == null || employee.employeeId == "") {
						$("#user_employeeid").text("无数据");
					} else {
						$("#user_employeeid").text(employee.employeeId);
					}
					if(employee_pic != null) {
						if(employee_pic.pngUrl != null && employee_pic.pngUrl != "" && employee_pic.pngUrl != "https://imgcdn.guoanshequ.com/") {
							$(".img-circle").attr("src", decodeURI(employee_pic.pngUrl));
						} else {
							$(".img-circle").attr("src", "../images/my_card_head.png");
						}

					} else {
						$(".img-circle").attr("src", "../images/my_card_head.png");
					}

				}
			}

			//跳转到修改密码
			function toUpdatePassword() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('update_password');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'update_password.html',
						id: 'update_password',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转本月数据动态
			function toCard() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('dataCard');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'dataCard.html',
						id: 'dataCard',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到门店数据卡
			function toStoreDataCard() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('storeDataCard');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'storeDataCard.html',
						id: 'storeDataCard',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到店长个人信息
			function toInfromation() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('web_information');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'web_information.html',
						id: 'web_information',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到国安侠列表
			function toGuoAnXiaList() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('web_guoanxialist');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'web_guoanxialist.html',
						id: 'web_guoanxialist',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到片区信息
			function toUser() {
				if(selectArea_list == null || selectArea_list == "" || selectArea_list.length == 0) {
					mui.toast("暂无划片区域");
				} else {
					setTimeout(function() {
						var webview = plus.webview.getWebviewById('web_user');
						if(webview != null) {
							webview.close();
						}
						mui.openWindow({
							url: 'web_user.html',
							id: 'web_user',
							createNew: true,
							show: {
								aniShow: 'slide-in-right'
							},
							waiting: {
								autoShow: false
							}
						});
					}, 100);
				}

			};

			function initStore() {
				store = JSON.parse(localStorage.getItem("store"));
				storelist = JSON.parse(localStorage.getItem("storelist"));
				getStorelist();
				if(store != null) {
					if(storelist.length <= 1) {
						mui("#div_title")[0].innerHTML = store.name;
						mui("#storeid")[0].innerHTML = store.storeno;
						store_no = store.storeno;
						$("#select").hide();
					} else {
						$("#select").show();
						$("div_title").hide();
						mui("#storeid")[0].innerHTML = store.storeno;
						store_no = store.storeno;
					}

				} else {
					getStore($('.select option:selected').val());
				}

			}

			function getStorelist() {
				if(storelist != null || storelist != "") {

					$(storelist).each(function(index, element) {
						if(index == 0) {
							$('#select').append('<option selected="selected" value=' + element.store_id + '>' + element.name + '</option>');
						} else {
							$('#select').append('<option value=' + element.store_id + '>' + element.name + '</option>');
						}
					});
					if(store != null) {
						$('#select').val(store.store_id);
					}

				} else {
					mui("#div_title")[0].innerHTML = "国安社区";
					$('#select').hide();
					$('#store_num').hide();
				}

			}
			//获取门店信息
			function getStore(store_id) {
				if(store_id == null || store_id == "" || store_id == "null") {
					mui("#div_title")[0].innerHTML = "国安社区";
					$("#select").hide();
					$("#store_num").hide();
					return;
				}
				doManager("StoreManager", "findStore", store_id, function(data) {
					if(data.result == true) {
						var jsonStore = JSON.parse(data.data);
						localStorage.setItem("store", JSON.stringify(jsonStore));
						mui("#div_title")[0].innerHTML = jsonStore.name;
						mui("#storeid")[0].innerHTML = jsonStore.storeno;
						store_no = jsonStore.storeno;
						if(storelist.length <= 1) {
							$("#select").hide();
						} else {
							$("#select").show();
							$("#div_title").hide();
						}

					} else {
						$("#select").hide();
						$("#store_num").hide();
						mui("#div_title")[0].innerHTML = "国安社区";

					}
				});

			}

			//获取门店信息
			function getStore_change(store_id) {
				if(store_id == null || store_id == "" || store_id == "null") {
					mui("#div_title")[0].innerHTML = "国安社区";
					$("#select").hide();
					$("#store_num").hide();
					return;
				}
				doManager("StoreManager", "findStore", store_id, function(data) {
					if(data.result == true) {
						var jsonStore = JSON.parse(data.data);
						localStorage.setItem("store", JSON.stringify(jsonStore));
						mui("#div_title")[0].innerHTML = jsonStore.name;
						mui("#storeid")[0].innerHTML = jsonStore.storeno;
						store_no = jsonStore.storeno;
						if(storelist.length <= 1) {
							$("#select").hide();
						} else {
							$("#select").show();
							$("#div_title").hide();
						}

					} else {
						$("#select").hide();
						$("#store_num").hide();
						mui("#div_title")[0].innerHTML = "国安社区";

					}
				}, false);

			}
			
			$(document).ready(function() {
				$('#select').change(function() {
					var a = $('#select option:selected').text();
					$('#select span').text(a);
					getStore_change($('#select option:selected').val());
					if(mui.os.ios) {
						setTimeout(function() {
							window.location.reload();
						}, 350);
					} else {
						window.location.reload();
					}
				})
			});
			//跳转到营业额
			function toTurnover(){
				alert("跳转到营业额");
				
			}
			//跳转到客户
			function toCustomer(){
				alert("跳转到客户");
			}
			//跳转到线下网络
			function toNetwork(){
				alert("跳转到线下网络");
			}
			//跳转到其他
			function toOther(){
				alert("跳转到其他");
				
			}

		</script>
	</body>

</html>