<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>国安侠混片儿主页(片区动态)</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<!-- Ionicons -->
		<link rel="stylesheet" href="../css/ionicons.min.css">
		<!-- Morris charts -->
		<!--<link rel="stylesheet" href="../css/morris.css">-->
		<!-- Theme style -->
		<link rel="stylesheet" href="../css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="../css/_all-skins.min.css">
		<link rel="stylesheet" href="../css/img_preview.css">
		<link rel="stylesheet" href="../css/web_index_search.css">
		<link rel="stylesheet" href="../css/newmui.min.css">

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
		<style>
			html,
			body {
				background: #fff;
			}
			
			.navbar-nav>.user-menu>.dropdown-menu>li.user-header>p {
				line-height: 22px;
			}
			
			header {
				position: fixed!important;
				width: 100%;
			}
			
			.mui-slider-indicator {
				position: fixed;
				top: 65px;
				background-color: #fff;
				z-index: 99;
				border-bottom: 1px solid #f2f2f2;
			}
			
			.mui-slider-progress-bar {
				margin-top: 104px;
				position: fixed;
			}
			
			.express {
				position: relative;
				background-color: transparent;
				border: 0;
				margin-top: 25px;
			}
			
			.express:nth-child(1) {
				margin-top: 5px;
			}
			
			.express section .express_time {
				margin-bottom: 5px;
				padding-left: 10px;
			}
			
			.express section .box-header {
				background-color: #fff;
				padding: 15px 15px 5px 15px;
			}
			
			.mui-control-content {
				overflow-y: scroll;
			}
			
			.fdPhone {
				position: fixed;
				_position: absolute;
				width: 100%;
				height: 100px;
				position: fixed;
				top: 0px;
				display: none;
			}
			
			.image {
				color: #fff;
			}
			
			.box {
				box-shadow: none!important
			}
			
			.select_store {
				height: 3rem;
				width: 50%;
				margin-left: 20px;
				background: #000;
			}
			
			.select {
				height: 3rem;
				width: 50%;
				margin-left: 20px;
				background: #000;
				color: #fff;
			}
			
			footer {
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100%;
				border-top: 1px solid #c3c3c3;
				background-color: #fff;
				text-align: center;
				color: #666;
				height: 50px;
				padding-top: 2px;
			}
			
			footer p {
				font-size: 20px;
				margin: 0 0 -3px 0;
			}
			
			footer a {
				margin: 0;
				font-size: 14px;
			}
			
			footer a,
			footer a:hover,
			footer a:active,
			footer a:visited {
				color: #666;
			}
			
			.mark-green {
				color: #169a80!important;
			}
			
			.statistics {
				background-color: #fff;
				padding: 40px 25px;
				;
				height: 100%;
			}
			
			.dt1 {
				border: 1px solid #fa6567;
				padding: 0 15px 10px 15px;
			}
			
			.dt2 {
				border: 1px solid #5abeed;
				padding: 0 15px 10px 15px;
				margin-top: 20px;
			}
			
			.dt3 {
				border: 1px solid #f1a90d;
				padding: 0 15px 10px 15px;
				margin-top: 20px;
			}
			
			.dt4 {
				border: 1px solid #00bfa2;
				padding: 0 15px 10px 15px;
				margin-top: 20px;
			}
			
			.dt_l {
				width: 15%;
				margin-top: 10px;
				padding-top: 15px;
			}
			
			.dt_l img {
				width: 100%;
			}
			
			.dt_r {
				margin-left: 10px;
				width: 80%;
				padding-top: 5px;
			}
			
			.dt_r h4 {
				color: #404040;
				padding-top: 20px;
				margin: 0;
				font-size: 16px;
			}
			
			.dt_r h4 p {
				font-size: 20px;
				font-weight: bold;
				padding-top: 10px;
				font-family: Arial, Helvetica, sans-serif;
			}
			
			.dt_r .pull-right {
				color: #afafaf;
				font-size: 12px;
			}
			
			.dt5 {
				padding-top: 10px;
				color: #afafaf;
			}
			
			.order_p {
				display: -webkit-box;
				text-overflow: ellipsis;
				overflow: hidden;
				text-overflow: ellipsis;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
			}
			
			#map {
				width: 100%;
				position: fixed;
				top: 20px;
				bottom: 0px;
				line-height: 200px;
				text-align: center;
				background: #FFFFFF;
			}
			
			.modal-content {
				margin-top: 15px;
			}
		</style>
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<!--主体-->
		<div class="mui-off-canvas-wrap  mui-slide-in" id="offCanvasWrapper">
			<!--主页部分-->
			<div class="wrapper mui-inner-wrap">
				<header class="main-header" style="position: fixed;display: block;">
					<!-- Logo -->
					<nav class="navbar navbar-static-top text-center">
						<span> 门店动态</span>
						<a href="#offCanvasSide" class="sidebar-toggle fa fa-navicon mui-icon-bars"></a>

					</nav>
				</header>
				<div class="mui-content mui-inner-wrap" style="height: auto;">
					<div id="slider" class="mui-slider">
						<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
                            <a class="mui-control-item mui-active" href="#item1mobile">动态统计</a>
							<a class="mui-control-item" href="#item2mobile">片区排序</a>
							<a class="mui-control-item" href="#item3mobile">人员排序</a>
						</div>

						<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
						<div class="mui-slider-group">
							<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
								<div id="scroll1">
									<div class="mui-scroll mui-content-padded">
										<div class="box box-primary" style="margin-top: 20px;">
											<div class="box-header with-border">门店动态统计</div>
											<div id="main1" style="width: 100%;height:300px;"></div>
										</div>

									</div>
								</div>
							</div>

							<div id="item2mobile" class="mui-slider-item mui-control-content">
								<div id="scroll2">
									<div class="mui-scroll" id="item2div">
										<div class="box box-info" style="margin-top: 20px;">
											<div class="box-header with-border">拜访记录与用户画像</div>
											<div id="main4" style="width: 100%;height:300px;"></div>
										</div>
									</div>
								</div>
							</div>

							<div id="item3mobile" class="mui-slider-item mui-control-content">
								<div id="scroll3">
									<div class="mui-scroll" id="item3div">
										<div class="box box-primary" style="margin-top: 20px;">
											<div class="box-header with-border">送单量</div>
											<div id="main5" style="width: 100%;height:300px;"></div>
										</div>
										<div class="box box-danger">
											<div class="box-header with-border">拜访记录</div>
											<div id="main6" style="width: 100%;height:300px;"></div>
										</div>
										<div class="box box-danger">
											<div class="box-header with-border">快递代送</div>
											<div id="main7" style="width: 100%;height:300px;"></div>
										</div>
										<div class="box box-danger">
											<div class="box-header with-border">用户画像</div>
											<div id="main8" style="width: 100%;height:300px;"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<footer style="display: none;" >
							<a class="col-xs-3" id="maps" path="maps.html" onclick="jump(this)">
								<p><i class="fa fa-globe"></i></p>地图</a>
							<a class="col-xs-3 mark-green" id="areaState" href="javascript:void(0)">
								<p><i class="fa fa-user"></i></p>混片儿</a>
							<a class="col-xs-3" id="web_message" path="web_message.html" onclick="jump(this)">
								<p><i class="fa fa-envelope-o"></i></p>消息
								<div id="message_state_div"></div>
							</a>
							<a class="col-xs-3" id="tabbar" path="tabbar.html" onclick="jump(this)">
								<p><i class="fa fa-file-text-o"></i></p>录入</a>
							

						</footer>

					</div>

				</div>
				<div class="mui-off-canvas-backdrop" id="backdrop"></div>
			</div>
			<!--侧滑部分-->
			<aside id="offCanvasSide" class="main-sidebar mui-off-canvas-left">
				<!-- sidebar: style can be found in sidebar.less -->
				<section id="offCanvasSideScroll" class="sidebar">
					<!-- Sidebar user panel -->
					<div class="user-panel">

						<div class="text-center image">
							<img src="" class="img-circle" data-preview-src="" data-preview-group="1">
							<p style="margin-top: 10px;"><strong id="user_name"></strong></p>
							<p><span id="user_zw"></span><span id="user_employeeid"></span></p>

						</div>
					</div>
					<!-- sidebar menu: : style can be found in sidebar.less -->
					<ul class="sidebar-menu">
						<div style="padding:12px 0px 0px 18px;">
							<a>
								<span>所属门店：</span>
								<span id="div_title"></span>
								<select class="select_store" id="select_store" style="margin-left: 0px;">
								</select>
							</a>
						</div>
						<div id="store_num" style="padding:18px 0px 10px 18px;">
							<a><span>门店编号：</span><span id="storeid" style="margin-left: 4px;"></span>
							</a>
						</div>
						<li class="treeview">
							<a onclick="toStoreDataCard()">
								<span>门店数据卡</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview">
							<a onclick="toInfromation()">
								<span>个人信息</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview">
							<a onclick="toGuoAnXiaList()">
								<span>门店人员</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>
						<li class="treeview">
							<a onclick="toUpdatePassword()">
								<span>修改密码</span> <i class="fa  fa-angle-right pull-right"></i>
							</a>
						</li>

						<li class="text-center" style="margin-top: 2rem;">
							<a id="btnLogout">退出登录</a>
						</li>

					</ul>

				</section>
			</aside>
		</div>
		<!-- jQuery 2.2.0 -->
		<script src="../js/jQuery-2.2.0.min.js"></script>
		<!-- Bootstrap 3.3.6 -->
		<script src="../js/bootstrap.min.js"></script>
		<!-- Morris.js charts -->
		<script src="../js/raphael-min.js"></script>
		<!-- FastClick -->
		<script src="../js/fastclick.js"></script>
		<!-- AdminLTE App -->
		<script src="../js/app.min.js"></script>
		<script src="../js/echarts.common.min.js"></script>
		<!-- 滑动js -->
		<script src="../js/mui.min.js"></script>
		<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
		<script type="text/javascript" src="../js/custom_common.js"></script>
		<script src="../js/previewimage.js"></script>
		<script src="../js/mui.zoom.js"></script>
		<script src="../js/date_util.js"></script>
		<script>
			// 基于准备好的dom，初始化echarts实例
			var myChart1 = echarts.init(document.getElementById('main1'));
			var myChart4 = echarts.init(document.getElementById('main4'));
			var myChart5 = echarts.init(document.getElementById('main5'));
			var myChart6 = echarts.init(document.getElementById('main6'));
			var myChart7 = echarts.init(document.getElementById('main7'));
			var myChart8 = echarts.init(document.getElementById('main8'));

			// 指定图表的配置项和数据
			var option1 = {

				tooltip: {
					trigger: 'axis'
				},
				legend: {
					//					data: ['订单量', '订单金额', '拜访记录', '用户画像']
					data: ['拜访记录', '用户画像']
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					top: '15%',
					containLabel: true
				},
				xAxis: {
					type: 'category',
					boundaryGap: false,
					data: []
				},
				yAxis: {
					type: 'value'
				},
				series: [
					//				    {
					//						name: '订单量',
					//						type: 'line',
					//						stack: '总量',
					//						data: []
					//					},
					//					{
					//						name: '订单金额',
					//						type: 'line',
					//						stack: '总量',
					//						data: []
					//					},
					{
						name: '拜访记录',
						type: 'line',
						stack: '总量',
						data: []
					},
					{
						name: '用户画像',
						type: 'line',
						stack: '总量',
						data: []
					}
				]
			};

			//	
			var option4 = {
				tooltip: {
					trigger: 'axis',
					axisPointer: { // 坐标轴指示器，坐标轴触发有效
						type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				legend: {
					data: ['拜访记录', '用户画像'],
					align: 'right',
					right: 10
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis: [{
					type: 'category',
					data: []
				}],
				yAxis: [{
					type: 'value',
					name: '',
					axisLabel: {
						formatter: '{value}'
					}
				}],
				series: [{
					name: '拜访记录',
					type: 'bar',
					data: [],
					label: {
						normal: {
							show: true,
							position: 'top' //值显示
						}
					}
				}, {
					name: '用户画像',
					type: 'bar',
					data: [],
					label: {
						normal: {
							show: true,
							position: 'top' //值显示
						}
					}
				}]
			};

			var option5 = {
				color: ['#3398DB'],
				tooltip: {
					trigger: 'axis',
					axisPointer: { // 坐标轴指示器，坐标轴触发有效
						type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis: [{
					type: 'category',
					data: [],
					axisTick: {
						alignWithLabel: true
					}
				}],
				yAxis: [{
					// type : 'category',
					// data : ['10','20','30','40'],
					axisTick: {
						alignWithLabel: true
					}
				}],
				series: [{
						name: '送单量',
						type: 'bar',
						barWidth: '40%',
						data: []
					},

				],
				label: {
					normal: {
						show: true,
						position: 'top',
						formatter: '{c}'
					}
				},
				itemStyle: {
					normal: {

						color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							offset: 0,
							color: 'rgba(17, 168,171, 1)'
						}, {
							offset: 1,
							color: 'rgba(17, 168,171, 0.1)'
						}]),
						shadowColor: 'rgba(0, 0, 0, 0.1)',
						shadowBlur: 10
					}
				}
			};

			var option6 = {
				tooltip: {
					trigger: 'item',
					formatter: "{a} <br/>{b} : {c} ({d}%)"
				},

				series: [{
					name: '拜访记录',
					type: 'pie',
					radius: '60%',
					center: ['50%', '50%'],
					data: [],
					itemStyle: {
						emphasis: {
							shadowBlur: 10,
							shadowOffsetX: 0,
							shadowColor: 'rgba(0, 0, 0, 0.5)'
						}
					}
				}]
			};

			var option7 = {
				color: ['#3398DB'],
				tooltip: {
					trigger: 'axis',
					axisPointer: { // 坐标轴指示器，坐标轴触发有效
						type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					top: '5%',
					containLabel: true
				},
				xAxis: [{
					type: 'category',
					data: [],
					axisTick: {
						alignWithLabel: true
					}
				}],
				yAxis: [{
					type: 'value'
				}],
				series: [{
					name: '快递代送',
					type: 'bar',
					barWidth: '60%',
					data: [],
					label: {
						normal: {
							show: true,
							position: 'top' //值显示
						}
					}
				}]
			};

			var option8 = {
				tooltip: {
					trigger: 'item',
					formatter: "{a} <br/>{b} : {c} ({d}%)"
				},
				series: [{
					name: '用户画像',
					type: 'pie',
					radius: '60%',
					center: ['50%', '50%'],
					data: [],
					itemStyle: {
						emphasis: {
							shadowBlur: 10,
							shadowOffsetX: 0,
							shadowColor: 'rgba(0, 0, 0, 0.5)'
						}
					}
				}]
			};
			
			var employee = JSON.parse(localStorage.getItem('employee'));
			var employee_pic = JSON.parse(localStorage.getItem('employee_pic'));
			//var store_list = JSON.parse(localStorage.getItem('storelist'));
			//var default_storeid = JSON.parse(localStorage.getItem('default_storeid'));
			var item2 = document.getElementById('item2mobile');
			var item3 = document.getElementById('item3mobile');
			var select_storeid = null;
			var store = null;
			var storelist = null;
			var mDate = new Date();
			var myear = mDate.getFullYear(); //当前年
			var mmonth = mDate.getMonth() + 1; //本月
			var last_mmonth = mDate.getMonth(); //上一月
			var h='';
			mui.previewImage();
			mui.init({
				swipeBack: false
			});
			mui.plusReady(function() {
				if(employee.usergroup != null) {
					if(employee.usergroup.code == 'ZHGLY' || employee.usergroup.code == 'DZ' || employee.usergroup.code == 'GAX' || employee.usergroup.code == 'FDZJSZ') {
						$("footer").css("display", "");
					} else {
						$("footer").css("display", "");
						$("#tabbar").attr("style", "display:none;");
						$("#maps").attr("class", "col-xs-4 ");
						$("#areaState").attr("class", "col-xs-4 mark-green");
						$("#web_message").attr("class", "col-xs-4 ");
					}
				}
				message_isread();
				initView();
				initStore();
				
				h = plus.screen.resolutionHeight;
				if('Android' == plus.os.name) {
					var first = null;
					mui.back = function() {
						if(!first) {
							first = new Date().getTime();
							mui.toast('再按一次退出应用');
							setTimeout(function() {
								first = null;
							}, 1000);
						} else {
							if(new Date().getTime() - first < 1000) {
								plus.runtime.quit();
							}
						}
					}
				}
				$('.mui-control-content').css("height", h);
				if(store == null || store == "" || store.store_id == null || store.store_id == "") {
					getRelationAndCustomer(employee.store_id,null);
					getRelationOfCrm(employee.store_id, null);
					getCustomerOfCrm(employee.store_id, null);
					getData(employee.store_id);
					getOrderCount(employee.store_id);
					getExpressCount(employee.store_id);
				} else {
					getRelationAndCustomer(store.store_id,null);
					getRelationOfCrm(store.store_id, null);
					getCustomerOfCrm(store.store_id, null);
					getData(store.store_id);
					getOrderCount(store.store_id);
					getExpressCount(store.store_id);
				}
				var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
				$('.mui-input-group').on('change', 'input', function() {
					if(this.checked) {
						sliderSegmentedControl.className = 'mui-slider-indicator mui-segmented-control mui-segmented-control-inverted mui-segmented-control-' + this.value;
						//force repaint
						sliderProgressBar.setAttribute('style', sliderProgressBar.getAttribute('style'));
					}
				});
				//退出
				var t_username = localStorage.getItem("employee_key");
				mui('#btnLogout')[0].addEventListener('click', function(event) {
					setTimeout(function() {
						var webview = plus.webview.getWebviewById('login');
						if(webview != null) {
							webview.close();
						}
						localStorage.clear();
						localStorage.setItem("employee_key", t_username);
						mui.openWindow({
							url: '../login.html',
							id: 'login',
							createNew: true,
							show: {
								aniShow: "slide-in-right"
							},
							waiting: {
								autoShow: false
							}
						});
					}, 50);

				});


			});
			//查看消息列表是否有未读信息，如有未读信息消息显示红点
			function message_isread() {
				var message = {
					receiveId: employee.employeeId
				};
				doManager('MessageNewManager', 'getUnReadMessageAmount', message, function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						if(jsonData == 0 || jsonData == null) {
							$('#message_state_div').removeClass("message-dian1");
						} else {
							$('#message_state_div').addClass("message-dian1");
						}

					}
				});
			}
			function initView() {
				if(employee != null) {
					if(employee.name == null || employee.name == "") {
						$("#user_name").html("无数据");
					} else {
						$("#user_name").html(employee.name);
					}
					if(employee.zw == null || employee.zw == "") {
						$("#user_zw").text("无数据");
					} else {
						$("#user_zw").text(employee.zw);
					}

					if(employee.employeeId == null || employee.employeeId == "") {
						$("#user_employeeid").text("无数据");
					} else {
						$("#user_employeeid").text(employee.employeeId);
					}
					if(employee_pic != null) {
						if(employee_pic.pngUrl != null && employee_pic.pngUrl != ""&& employee_pic.pngUrl != "https://imgcdn.guoanshequ.com/") {
							$(".img-circle").attr("src", decodeURI(employee_pic.pngUrl));
						} else {
							$(".img-circle").attr("src", "../images/my_card_head.png");
						}

					} else {
						$(".img-circle").attr("src", "../images/my_card_head.png");
					}

				}

			}
			function initStore() {
				store = JSON.parse(localStorage.getItem("store"));
				storelist = JSON.parse(localStorage.getItem("storelist"));
				getStorelist();
				if(store != null) {
					if(storelist.length <= 1) {
						mui("#div_title")[0].innerHTML = store.name;
						mui("#storeid")[0].innerHTML = store.storeno;
						$("#select_store").hide();
					} else {
						mui("#storeid")[0].innerHTML = store.storeno;
						$("#select_store").show();
						$("#div_title").hide();
					}

				} else {
					getStore($('.select_store option:selected').val());
				}

			}
			function getStorelist() {
				if(storelist != null || storelist != "") {
					$(storelist).each(function(index, element) {
						if(index == 0) {
							$('#select_store').append('<option selected="selected" value=' + element.store_id + '>' + element.name + '</option>');
						} else {
							$('#select_store').append('<option value=' + element.store_id + '>' + element.name + '</option>');
						}
					});
					if(store != null) {
						$('#select_store').val(store.store_id);
					}

				} else {
					mui("#div_title")[0].innerHTML = "国安社区";
					$('#select_store').hide();
					$("#store_num").hide();
				}

			}
			//片区排序：拜访记录与用户画像柱状图
			function getRelationAndCustomer(store_id,query_date) {
				doManager('InterManager', 'getRelationAndCustomerOfCrm_app',[store_id, query_date], function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						var dateArry = new Array();
						var relationArry = new Array();
						var customerArry = new Array();
						$(jsonData.data.relation).each(function(index, relation) {
							dateArry[index] = relation.areaName;
							relationArry[index] = relation.total;

						});
						$(jsonData.data.customer).each(function(index, relation) {
							customerArry[index] = relation.total;

						});
						option4.xAxis[0].data = dateArry;
						option4.series[0].data = relationArry;
						option4.series[1].data = customerArry;
						myChart4.setOption(option4);

						var option4_data = null;
						myChart4.on('click', function(option4_) {
							if(option4_data == null) {
								option4_data = option4_.name;
							} else {
								if(option4_data == option4_.name) {
									if(store == null || store == "" || store.store_id == null || store.store_id == "") {
										getAreaId(option4_.name, employee.store_id);
									} else {
										getAreaId(option4_.name, store.store_id);
									}
									option4_data = null;
								}
								option4_data = option4_.name;
							}
						});

					}
				});
			}
			//人员排序：拜访记录排序饼图
			function getRelationOfCrm(store_id, query_date) {
				doManager('InterManager', 'getRelationOfCrm_app', [store_id, query_date], function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						var dateArry = new Array();
						var employeeIdArry = new Array();
						$(jsonData.data).each(function(index, relation) {
							var dataMap = {
								value: relation.total,
								name: relation.name
							};
							dateArry[index] = dataMap;
							employeeIdArry[index] = relation.employeeId;
						});
						option6.series[0].data = dateArry;
						myChart6.setOption(option6);
						var option6_data = null;
						myChart6.on('click', function(option6_) {
							if(option6_data == null) {
								option6_data = employeeIdArry[option6_.dataIndex];
							} else {
								if(option6_data == employeeIdArry[option6_.dataIndex]) {
									option6_data = null;
									toGoAnXiaInformation(employeeIdArry[option6_.dataIndex]);
								}
								option6_data = employeeIdArry[option6_.dataIndex];
							}
						});
					}
				});
			}
			//人员排序：用户画像排序饼图
			function getCustomerOfCrm(store_id, query_date) {
				doManager('InterManager', 'getCustomerOfCrm_app', [store_id, query_date], function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						var dateArry = new Array();
						var employeeIdArry = new Array();
						$(jsonData.data).each(function(index, customer) {
							var dataMap = {
								value: customer.total,
								name: customer.name
							};
							dateArry[index] = dataMap;
							employeeIdArry[index] = customer.employeeId;
						});
						option8.series[0].data = dateArry;
						myChart8.setOption(option8);
						var option8_data = null;
						myChart8.on('click', function(option8_) {
							if(option8_data == null) {
								option8_data = employeeIdArry[option8_.dataIndex];
							} else {
								if(option8_data == employeeIdArry[option8_.dataIndex]) {
									option8_data = null;
									toGoAnXiaInformation(employeeIdArry[option8_.dataIndex]);
								}
								option8_data = employeeIdArry[option8_.dataIndex];
							}
						});
					}
				});
			}
			//动态统计：门店动态折线图
			function getData(store_id) {
				doManager('InterManager', 'queryRelationAndCustomerOfYear_crm_app', store_id, function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						var dateArry = new Array();
						var relationArry = new Array();
						var customerArry = new Array();
						var orderArry = new Array();
						var orderpriceArry = new Array();
						var order_sum = 0;
						var relation_sum = 0;
						var customer_sum = 0;
						$(jsonData.data.relation).each(function(index, relation) {
							dateArry[index] = relation.date;
							relationArry[index] = relation.total;
							relation_sum += relation.total;
							window.localStorage.setItem("relation_sum", relation_sum);
						});

						$(jsonData.data.customer).each(function(index, customer) {
							customerArry[index] = customer.total;
							customer_sum += customer.total;
							window.localStorage.setItem("customer_sum", customer_sum);
						});
						$(jsonData.data.ordermonth).each(function(index, order) {
							orderArry[index] = order.total_count;
							orderpriceArry[index] = order.total_price;
							order_sum += order.total_count;
							window.localStorage.setItem("order_sum", order_sum);
						});
						option1.xAxis.data = dateArry;
						//						option1.series[0].data = orderArry;
						//						option1.series[1].data = orderpriceArry;
						option1.series[0].data = relationArry;
						option1.series[1].data = customerArry;
						myChart1.setOption(option1);
					}
				});
			}
			//人员排序：送单量 柱状图
			function getOrderCount(store_id) {
				doManager('InterManager', 'queryOrderCountByStoreId_crm_app', store_id, function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);

						var xArry = new Array();
						var ordercountArry = new Array();
						var employeeIdArry = new Array();
						$(jsonData.data.orders).each(function(index, order) {
							xArry[index] = order.employee_name.split("+")[0];
							ordercountArry[index] = order.count;
							employeeIdArry[index] = order.employee_name.split("+")[1];
						});

						option5.xAxis[0].data = xArry;
						option5.series[0].data = ordercountArry;
						myChart5.setOption(option5);
						var option5_data = null;
						myChart5.on('click', function(option5_) {
							if(option5_data == null) {
								option5_data = employeeIdArry[option5_.dataIndex];
							} else {
								if(option5_data == employeeIdArry[option5_.dataIndex]) {
									option5_data = null;
									toGoAnXiaInformation(employeeIdArry[option5_.dataIndex]);
								}
								option5_data = employeeIdArry[option5_.dataIndex];
							}
						});

					}
				});
			}
			//人员排序：快递代送 柱状图
			function getExpressCount(store_id) {
				doManager('InterManager', 'queryExpressListByStoreId_crm_app', store_id, function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						var xArry = new Array();
						var expresscountArry = new Array();
						var employeeIdArry = new Array();
						$(jsonData.data.express).each(function(index, expres) {
							xArry[index] = expres.employee_name;
							employeeIdArry[index] = expres.employee_no;
							expresscountArry[index] = expres.count;
						});

						option7.xAxis[0].data = xArry;
						option7.series[0].data = expresscountArry;
						myChart7.setOption(option7);
						var option7_data = null;
						myChart7.on('click', function(option7_) {
							if(option7_data == null) {
								option7_data = employeeIdArry[option7_.dataIndex];
							} else {
								if(option7_data == employeeIdArry[option7_.dataIndex]) {
									option7_data = null;
									toGoAnXiaInformation(employeeIdArry[option7_.dataIndex]);
								}
								option7_data = employeeIdArry[option7_.dataIndex];
							}
						});

					}
				});
			}
			//跳转到门店数据卡
			function toStoreDataCard() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('storeDataCard');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'storeDataCard.html',
						id: 'storeDataCard',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到店长个人信息
			function toInfromation() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('web_information');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'web_information.html',
						id: 'web_information',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};

			//跳转到选择页面
			function toIndex(store_id, area_id, area_name) {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('web_area');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'web_area.html',
						id: 'web_area',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						},
						extras: {
							store_id: store_id,
							area_id: area_id,
							area_name: area_name
						}
					});
				}, 0);
			};

			//跳转到国安侠详细页面
			function toGoAnXiaInformation(employee_id) {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('other_web_user');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'other_web_user.html',
						id: 'other_web_user',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						},
						extras: {
							employeeid: employee_id,
							to_type: '999999'
						},

					});
				}, 0);
			};
			//跳转到国安侠列表
			function toGuoAnXiaList() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('web_guoanxialist');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'web_guoanxialist.html',
						id: 'web_guoanxialist',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//跳转到修改密码
			function toUpdatePassword() {
				setTimeout(function() {
					var webview = plus.webview.getWebviewById('update_password');
					if(webview != null) {
						webview.close();
					}
					mui.openWindow({
						url: 'update_password.html',
						id: 'update_password',
						createNew: true,
						show: {
							aniShow: 'slide-in-right'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};
			//通过片区名称查询片区ID
			function getAreaId(area_name, store_id) {
				doManager('AreaManager', 'queryAreaByAreaName', [area_name, store_id], function(data) {
					if(data.result == true) {
						var jsonData = JSON.parse(data.data);
						toIndex(store_id, jsonData.id, area_name);

					}
				});
			}
			$(document).ready(function() {
				$('#select_store').change(function() {
					var a = $('#select_store option:selected').text();
					$('#select_store span').text(a);
					getStore_change($('#select_store option:selected').val());
					if(mui.os.ios) {
						setTimeout(function() {
							window.location.reload();
						}, 200);
					} else {
						window.location.reload();
					}
				})
			});
			//获取门店信息
			function getStore_change(store_id) {
				if(store_id == null || store_id == "" || store_id == "null") {
					mui("#div_title")[0].innerHTML = "国安社区";
					$("#select_store").hide();
					$("#store_num").hide();
					return;
				}
				doManager("StoreManager", "findStore", store_id, function(data) {
					if(data.result == true) {
						var jsonStore = JSON.parse(data.data);
						localStorage.setItem("store", JSON.stringify(jsonStore));
						mui("#div_title")[0].innerHTML = jsonStore.name;
						mui("#storeid")[0].innerHTML = store.storeno;
						if(storelist.length <= 1) {
							$("#select_store").hide();
						} else {
							$("#select_store").show();
							$("#div_title").hide();
						}

					} else {
						$("#select_store").hide();
						$("#store_num").hide();
						mui("#div_title")[0].innerHTML = "国安社区";

					}
				},false);

			}
			//获取门店信息
			function getStore(store_id) {
				if(store_id == null || store_id == "" || store_id == "null") {
					mui("#div_title")[0].innerHTML = "国安社区";
					$("#select_store").hide();
					$("#store_num").hide();
					return;
				}
				doManager("StoreManager", "findStore", store_id, function(data) {
					if(data.result == true) {
						var jsonStore = JSON.parse(data.data);
						localStorage.setItem("store", JSON.stringify(jsonStore));
						mui("#div_title")[0].innerHTML = jsonStore.name;
						mui("#storeid")[0].innerHTML = store.storeno;
						if(storelist.length <= 1) {
							$("#select_store").hide();
						} else {
							$("#select_store").show();
							$("#div_title").hide();
						}

					} else {
						$("#select_store").hide();
						$("#store_num").hide();
						mui("#div_title")[0].innerHTML = "国安社区";

					}
				});

			}


		</script>
	</body>

</html>